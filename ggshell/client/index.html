<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/phaser/2.6.2/phaser.js"></script>
  <script type="text/javascript" src="/lib/porthole.min.js"></script>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <title>ggshell</title>
</head>
<body>
  <div id="gamebox">
  <div id="errorconsole">
    <h1>error</h1>
    <div id="errormsg"></div>
  </div>
    <script>
      function onMessage(messageEvent) {
        if(messageEvent.data.script) {
          if(sessionStorage){
            sessionStorage.script = messageEvent.data.script;
          }
          // refresh ggshell src code so global namespace is also refreshed
          location.reload();
        }
        document.getElementById("test").innerHTML = "WORKED!";
        console.log(messageEvent);
      }

      var windowProxy;

      window.onload = function(){
        handleError();
        windowProxy = new Porthole.WindowProxy("http://localhost:3000");
        windowProxy.addEventListener(onMessage);
        if(sessionStorage) {
          console.log('SESSION STORAGE: ', sessionStorage);
          if(sessionStorage.script){
            eval(sessionStorage.script);
          }
        }
      }

      function handleError() {
        window.onerror = (messageOrEvent, source, lineno, colno, error) => {
          var error_message = messageOrEvent;
          var error_source = source;
          var error_lineno = lineno;
          var error_colno = colno;
          var error = error;
          document.getElementsByTagName("canvas")[0].remove();
          document.getElementById("errorconsole").show();
        }
      }
    </script>
  </div>
</body>
</html>
