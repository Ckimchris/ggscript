<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/phaser/2.6.2/phaser.js"></script>
  <script type="text/javascript" src="/lib/porthole.min.js"></script>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <title>ggshell</title>
</head>
<body>
  <div id="gamebox">
    <script>
      function onMessage(messageEvent) {
        if(messageEvent.data.script) {
          if(sessionStorage){
            sessionStorage.script = messageEvent.data.script;
          }
          // refresh ggshell src code so global namespace is also refreshed
          location.reload();
        }
        document.getElementById("test").innerHTML = "WORKED!";
        console.log(messageEvent);
      }

      var windowProxy;

      window.onload = function(){
        windowProxy = new Porthole.WindowProxy("http://localhost:3000");
        windowProxy.addEventListener(onMessage);
        if(sessionStorage) {
          console.log('SESSION STORAGE: ', sessionStorage);
          if(sessionStorage.script){
            eval(sessionStorage.script);
          }
        }
      }
    </script>
  </div>
</body>
</html>
